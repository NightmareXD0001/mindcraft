<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Matrix MindCraft</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <section>
      <!-- BACKGROUND -->
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <span></span> <span></span> <span></span> <span></span> <span></span>
      <script type="module">
        document
          .getElementById("nextButton")
          .addEventListener("click", function () {
            nextQ();
          });

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import {
          getDatabase,
          ref,
          update,
          get,
        } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDUeIf5A92cxymtacZ8IxvlIxE7pT9sJWo",
          authDomain: "matrix-mindcraft.firebaseapp.com",
          databaseURL:
            "https://matrix-mindcraft-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "matrix-mindcraft",
          storageBucket: "matrix-mindcraft.appspot.com",
          messagingSenderId: "269035655467",
          appId: "1:269035655467:web:5e388db04c11078b74f56e",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Get a reference to the database service
        const db = getDatabase(app);

        let qNum = 0;
        const totalQ = 13;
        let username = "idk";
        let score = 0;
        const answer = Array(totalQ).fill("");
        const corrAns = [
          "",
          "",
          "georgestafford",
          "3.47",
          "phacidiaceae",
          "livonianwar",
          "siriusblack",
          "fatman",
          "mackenziemcdonald",
          "helenbrawn",
          "canada",
          "mercedesclr",
          "nilu27",
        ];

        function nextQ() {
          //declaring objects
          const btn = document.getElementById("nextButton");
          const quesTxt = document.getElementById("question");
          const ans = document.getElementById("answer");
          const qnaScr = document.getElementById("qnaScr");
          const endScr = document.getElementById("endScr");
          const scoreTxt = document.getElementById("score");
          const img = document.getElementById("qImg");

          //creating an array for storing questions and correct answers
          const question = [
            "Enter Username",
            "Enter Password",
            "Send a message in a bottle €",
            "$$$",
            "fungal disease from Home.",
            "49 54 56 53 13 10  u0076\\u0065\\u0067\\u0065\\u0074 \\u0061\\u0072\\u0069\\u0061\\u006e\\u000d -- ELLA",
            "The dog is burning. The potrait was scratched. Long before you reached the Bottom.",
            "Sub-species of bird that buries its head into the sand, an element you have in hand. \n Atomically pronic, the colour bland, \n the number is important, keep that in your mind. \n Go back a century and tell me what you find........ ",
            "Space won\x27t save you",
            "£1 \n I can\x27t see and I can\x27t hear, but I can write with no fear.",
            "34.0140281880751,-118.28751964143076 \n What do people call me? I am very fast. \n Where do I migrate in hot weather forecast?",
            "Flying",
            "lamborghini-->pagani \n koenigsegg--> ? ",
          ];

          const image = [
            "",
            "",
            "css/Q1.jpg",
            "css/Q2.jpg",
            "css/Q3.png",
            "css/Q4.png",
            "css/Q5.png",
            "",
            "css/Q7.png",
            "css/Q8.png",
            "",
            "css/Q10.png",
            "",
          ];

          if (qNum === 0) {
            username = ans.value;
            ans.value = ""; // Clear the input
            qNum++;
          } else if (qNum === 1) {
            const dbRef = ref(db, "user/" + username + "/password");
            // Read the data
            get(dbRef)
              .then((snapshot) => {
                if (snapshot.exists()) {
                  const password = snapshot.val();
                  if (ans.value === password) {
                    ans.value = ""; // Clear the input
                    qNum++;
                  } else {
                    alert("Incorrect password");
                    ans.style.outlineColor = "#red";
                  }
                } else {
                  alert("No such user");
                  ans.style.outlineColor = "#red";
                }
              })
              .catch((error) => {
                console.error(error);
              });
          } else {
            //SAVING ANSWER ----
            answer[qNum] = ans.value;

            //calculating score
            if (answer[qNum] === corrAns[qNum]) {
              qNum++;
              score++;
              const userRef = ref(db, "user/" + username);
              update(userRef, {
                finalscore: score,
              })
                .then(() => {
                  console.log("Score updated successfully!");
                })
                .catch((error) => {
                  console.error("Error updating score:", error);
                });

              //RESETTING VALUE OF TEXTBOX AND COLOR----
              ans.value = "";
              ans.style.outlineColor = "#222";

              //ADDING TO TOTAL NO. OF QUESTIONS AND SCORE----
            }
          }

          //CHANGING QUESTION TEXT AND IMAGE------
          img.src = image[qNum];
          quesTxt.innerText = qNum - 1 + "." + " " + question[qNum];

          //ENDING
          if (qNum >= totalQ) {
            //making end screen visible
            qnaScr.style.visibility = "hidden";
            endScr.style.visibility = "visible";
            scoreTxt.innerText = "Score: " + score;
          }
        }
      </script>

      <div class="box" id="qnaScr">
        <p id="question">Enter Username</p>
        <p id="alignCenter">
          <img id="qImg" src="" alt="Image in Question" />
        </p>
        <input type="text" id="answer" placeholder="Enter your answer" />
        <input type="button" value="Check" id="nextButton" />
      </div>

      <div class="box" id="endScr" style="visibility: hidden">
        <h2 style="margin-top: 100px">FINISHED</h2>
        <p id="score"></p>
      </div>
    </section>
  </body>
</html>
